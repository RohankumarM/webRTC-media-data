(this["webpackJsonpwebrtc-video-calling"]=this["webpackJsonpwebrtc-video-calling"]||[]).push([[0],{101:function(e,t,n){},102:function(e,t,n){},105:function(e,t,n){"use strict";n.r(t);var o=n(1),a=n(0),s=n.n(a),c=n(55),r=n.n(c),i=(n(70),n(16)),l=n(8),d=n(18),u=n(17),m=n(11),h=n(15),f=n(7),j=n(56),b=n.n(j),p=n(57),v=n.n(p),g=(n(96),function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(i.a)(this,n),(o=t.call(this,e)).muteMicHandler=function(e){var t=o.video.srcObject.getTracks().filter((function(e){return"audio"===e.kind}));o.setState((function(e){return t&&(t[0].enabled=!e.mic),{mic:!e.mic}}))},o.muteVideoHandler=function(e){var t=o.video.srcObject.getTracks().filter((function(e){return"video"===e.kind}));o.setState((function(e){return t&&(t[0].enabled=!e.camera),{camera:!e.camera}}))},o.state={mic:!0,camera:!0,settings:!1},o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.props.videoStream&&(this.video.srcObject=this.props.videoStream)}},{key:"componentWillReceiveProps",value:function(e){console.log(e.videoStream),e.videoStream&&e.videoStream!==this.props.videoStream&&(this.video.srcObject=e.videoStream)}},{key:"render",value:function(){var e=this,t=this.props.showMuteControls&&Object(o.jsxs)("div",{className:"local-video-controls",children:[Object(o.jsx)(v.a,{className:"settings"}),Object(o.jsx)("i",{onClick:this.muteMicHandler,style:{cursor:"pointer",padding:5,fontSize:25,color:this.state.mic?"white":"red"},className:"material-icons",children:this.state.mic?"mic":"mic_off"}),Object(o.jsx)("i",{onClick:this.muteVideoHandler,style:{cursor:"pointer",padding:5,fontSize:25,color:this.state.camera?"white":"red"},className:"material-icons",children:this.state.camera?"videocam":"videocam_off"})]});return Object(o.jsxs)("div",{style:Object(f.a)({},this.props.frameStyle),children:[Object(o.jsx)("video",{id:this.props.id,muted:this.props.muted,autoPlay:!0,style:Object(f.a)({},this.props.videoStyles),ref:function(t){e.video=t}}),t]})}}]),n}(s.a.Component)),O=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(i.a)(this,n),(o=t.call(this,e)).state={rVideos:[],remoteStreams:[]},o}return Object(l.a)(n,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(this.props.remoteStreams!==e.remoteStreams){var n=e.remoteStreams.map((function(e,n){var a=e.stream.getTracks().filter((function(e){return"video"===e.kind}))&&Object(o.jsx)(g,{videoStream:e.stream,frameStyle:{width:120,float:"left",padding:"0 3px"},videoStyles:{cursor:"pointer",objectFit:"cover",borderRadius:3,width:"100%"},autoplay:!0})||Object(o.jsx)("div",{});return Object(o.jsx)("div",{id:e.name,onClick:function(){return t.props.switchVideo(e)},style:{display:"inline-block"},children:a},n)}));this.setState({remoteStreams:e.remoteStreams,rVideos:n})}}},{key:"render",value:function(){return Object(o.jsx)("div",{style:{zIndex:3,position:"fixed",padding:"6px 3px",backgroundColor:"rgba(0,0,0,0.3)",maxHeight:120,top:"auto",right:10,left:10,bottom:10,whiteSpace:"nowrap"},children:this.state.rVideos})}}]),n}(a.Component),S=n(5),x=function(e){var t=Object(a.useState)(!1),n=Object(S.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)({x:0,y:0}),i=Object(S.a)(r,2),l=i[0],d=i[1],u=Object(a.useRef)();Object(a.useEffect)((function(){u.current&&(u.current.style.transform="translate(".concat(l.x,"px, ").concat(l.y,"px)"))}),[l]);return Object(o.jsx)("div",{style:e.style,ref:u,onMouseMove:function(e){s&&d({x:l.x+e.movementX,y:l.y+e.movementY})},onMouseDown:function(){return c(!0)},onMouseUp:function(){return c(!1)},children:e.children})},k=function(e){var t=Object(a.useState)("transparent"),n=Object(S.a)(t,2),s=n[0],c=n[1],r=function(e){console.log(e),c(e?"green":"transparent")};return Object(o.jsx)("div",{style:{backgroundColor:s},className:e.className,onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),r(!0),e.dataTransfer.dropEffect="copy",console.log("DragEnter",e.dataTransfer.items.length)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),r(!1),console.log("onDragLeave")},onDragOver:function(e){e.preventDefault(),e.stopPropagation(),console.log("onDragOver")},onDrop:function(t){t.preventDefault(),t.stopPropagation(),r(!1),console.log(t.dataTransfer.items),t.dataTransfer.files&&t.dataTransfer.files.length>0&&e.sendFiles(t.dataTransfer.files)},children:e.children})},y=function(e){var t=Object(a.useState)(""),n=Object(S.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)({uid:0}),i=Object(S.a)(r,2),l=i[0],d=i[1],u=Object(a.useState)(!1),m=Object(S.a)(u,2),h=m[0],f=m[1],j=Object(a.useState)(""),b=Object(S.a)(j,2),p=b[0],v=b[1],g=function(){var e=document.getElementById("chatList");e.scrollTop=e.scrollHeight};Object(a.useEffect)((function(){g(),d({uid:e.user.uid})}),[e]);var O,x=function(t){e.sendMessage(t),g()},y=function(e,t){console.log("===========",t);var n=t.message,a="text"===t.type&&Object(o.jsxs)("div",{className:"msg",children:[Object(o.jsx)("p",{children:n.sender.uid}),Object(o.jsxs)("div",{className:"message",children:[" ",n.data.text]})]})||Object(o.jsxs)("div",{className:"msg",children:[Object(o.jsx)("p",{children:n.sender.uid}),Object(o.jsx)("img",{alt:"message",onClick:function(){f(!0),v(n.data)},className:"message",style:{width:200,cursor:"pointer"},src:n.data})]});return Object(o.jsx)("li",{className:e,children:a})};return Object(o.jsxs)("div",{children:[h&&(O=p,Object(o.jsx)("img",{alt:"zoom",src:O,style:{backgroundColor:"black",position:"relative",zIndex:100,display:"block",cursor:"pointer",marginLeft:"auto",marginRight:"auto",padding:20,borderRadius:20},onClick:function(){return f(!1)}})),Object(o.jsxs)("div",{className:"chatWindow",style:{zIndex:10,position:"absolute",right:5,top:190,bottom:140,width:350},children:[Object(o.jsx)("ul",{className:"chat",id:"chatList",children:e.messages.map((function(e){return Object(o.jsx)("div",{children:l.uid===e.message.sender.uid?y("self",e):y("other",e)},e.id)}))}),Object(o.jsx)(k,{className:"chatInputWrapper",sendFiles:function(e){var t=new FileReader;t.onload=function(e){e.target.result.length<=262118?x({type:"image",message:{id:l.uid,sender:{uid:l.uid},data:e.target.result}}):alert("Message exceeds Maximum Message Size!")},t.readAsDataURL(e[0])},children:Object(o.jsx)("div",{children:Object(o.jsx)("form",{onSubmit:function(e){""!==s&&(e.preventDefault(),x({type:"text",message:{id:l.uid,sender:{uid:l.uid},data:{text:s}}}),c(""))},children:Object(o.jsx)("input",{className:"textarea input",type:"text",placeholder:"Enter your message...",onChange:function(e){c(e.target.value)},value:s})})})})]})]})},C=n(60),w=n.n(C),N=n(59),R=n.n(N),T=n(58),D=n.n(T),I=n(61),P=n.n(I),M=(n(101),function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(e){var o;return Object(i.a)(this,n),(o=t.call(this,e)).getLocalStream=function(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0,options:{mirror:!0}}).then((function(e){window.localStream=e,o.setState({localStream:e}),o.whoisOnline()})).catch((function(e){console.log("getUserMediaError",e)}))},o.whoisOnline=function(){o.sendToPeer("onlinePeers",null,{local:o.socket.id})},o.sendToPeer=function(e,t,n){o.socket.emit(e,{socketID:n,payload:t})},o.createPeerConnection=function(e,t){try{var n=new RTCPeerConnection(o.state.pcConfig);o.setState({localConnection:n});var a=Object(f.a)(Object(f.a)({},o.state.peerConnections),{},Object(h.a)({},e,n));o.setState({peerConnections:a}),n.onicecandidate=function(t){t.candidate&&o.sendToPeer("candidate",t.candidate,{local:o.socket.id,remote:e})},n.oniceconnectionstatechange=function(e){},n.ontrack=function(t){var n=null,a=o.state.remoteStreams,s={},c=o.state.remoteStreams.filter((function(t){return t.id===e}));c.length?((n=c[0].stream).addTrack(t.track,n),s=Object(f.a)(Object(f.a)({},c[0]),{},{stream:n}),a=o.state.remoteStreams.map((function(e){return e.id===s.id&&s||e}))):((n=new MediaStream).addTrack(t.track,n),s={id:e,name:e,stream:n},a=[].concat(Object(m.a)(o.state.remoteStreams),[s])),o.setState((function(e){var t=e.remoteStreams.length>0?{}:{remoteStream:n},o=e.remoteStreams.filter((function(t){return t.id===e.selectedVideo.id}));return o=o.length?{}:{selectedVideo:s},Object(f.a)(Object(f.a)(Object(f.a)({},o),t),{},{remoteStreams:a})}))},n.close=function(){},o.state.localStream&&o.state.localStream.getTracks().forEach((function(e){o.senders.push(n.addTrack(e,o.state.localStream))})),t(n)}catch(s){console.log("Something went wrong! pc not created!!",s),t(null)}},o.switchVideo=function(e){o.setState({selectedVideo:e})},o.handleChatWindowToggle=function(){o.state.chatWindow?o.setState({chatWindow:!1}):o.setState({chatWindow:!0})},o.shareScreen=function(){navigator.mediaDevices.getDisplayMedia({cursor:!0}).then((function(e){var t=e.getTracks()[0];o.senders.find((function(e){return"video"===e.track.kind})).replaceTrack(t),t.onended=function(){this.senders.find((function(e){return"video"===e.track.kind})).replaceTrack(this.state.localStream.getTracks()[1])}}))},o.handleFullscreen=function(){!1===o.state.fullScreen?(document.documentElement.requestFullscreen(),o.setState({fullScreen:!0})):(document.exitFullscreen(),o.setState({fullScreen:!1}))},o.state={localStream:null,remoteStream:null,remoteStreams:[],peerConnections:{},selectedVideo:null,status:"Please Wait...",pcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpContraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},messages:[],sendChannels:[],disconnected:!1,chatWindow:!1,fullScreen:!1},o.serviceIp="/webrtcPeer",o.fileNameRef=Object(a.createRef)(""),o.mainAppDiv=Object(a.createRef)(),o.controlsContent=Object(a.createRef)(),o.fullscreen=Object(a.createRef)(),o.statusBar=Object(a.createRef)(),o.socket=null,o.senders=[],o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.socket=b()(this.serviceIp,{path:"/webrtc-video-calling",query:{room:window.location.pathname}}),this.socket.on("connection-success",(function(t){e.getLocalStream();var n=t.peerCount>1?"Total Connected Peers in room ".concat(window.location.pathname,": ").concat(t.peerCount):"Waiting for other peers to connect";e.setState({status:n,messages:t.messages})})),this.socket.on("joined-peers",(function(t){e.setState({status:t.peerCount>1?"Total Connected Peers in room ".concat(window.location.pathname,": ").concat(t.peerCount):"Waiting for other peers to connect"})})),this.socket.on("peer-disconnected",(function(t){console.log("peer-disconnected",t);var n=e.state.remoteStreams.filter((function(e){return e.id!==t.socketID}));e.setState((function(e){var o=e.selectedVideo.id===t.socketID&&n.length?{selectedVideo:n[0]}:null;return Object(f.a)(Object(f.a)({remoteStreams:n},o),{},{status:t.peerCount>1?"Total Connected Peers in room ".concat(window.location.pathname,": ").concat(t.peerCount):"Waiting for other peers to connect"})}))})),this.socket.on("candidate",(function(t){var n=e.state.peerConnections[t.socketID];n&&n.addIceCandidate(new RTCIceCandidate(t.candidate))})),this.socket.on("online-peer",(function(t){console.log("connected peers ...",t),e.createPeerConnection(t,(function(n){if(n){var o=function(t){console.log("send channel status: "+e.state.sendChannels[0].readyState)},a=n.createDataChannel("sendChannel");a.onopen=o,a.onclose=o,e.setState((function(e){return{sendChannels:[].concat(Object(m.a)(e.sendChannels),[a])}}));var s=function(t){var n=JSON.parse(t.data);console.log(n),e.setState((function(e){return{messages:[].concat(Object(m.a)(e.messages),[n])}}))},c=function(t){e.receiveChannel&&console.log("receive channel's status has changed to "+e.receiveChannel.readyState)};n.ondatachannel=function(e){var t=e.channel;t.onmessage=s,t.onopen=c,t.onclose=c},n.createOffer(e.state.sdpConstraints).then((function(o){n.setLocalDescription(o),e.sendToPeer("offer",o,{local:e.socket.id,remote:t})}))}}))})),this.socket.on("offer",(function(t){e.createPeerConnection(t.socketID,(function(n){n.addStream(e.state.localStream);var o=function(t){console.log("send channel status: "+e.state.sendChannels[0].readyState)},a=n.createDataChannel("sendChannel");a.onopen=o,a.onclose=o,e.setState((function(e){return{sendChannels:[].concat(Object(m.a)(e.sendChannels),[a])}}));var s=function(t){var n=JSON.parse(t.data);console.log(n),e.setState((function(e){return{messages:[].concat(Object(m.a)(e.messages),[n])}}))},c=function(t){e.receiveChannel&&console.log("receive channel's status has changed to "+e.receiveChannel.readyState)};n.ondatachannel=function(e){var t=e.channel;t.onmessage=s,t.onopen=c,t.onclose=c},n.setRemoteDescription(new RTCSessionDescription(t.sdp)).then((function(){n.createAnswer(e.state.sdpContraints).then((function(o){n.setLocalDescription(o),e.sendToPeer("answer",o,{local:e.socket.id,remote:t.socketID})}))}))}))})),this.socket.on("answer",(function(t){var n=e.state.peerConnections[t.socketID];console.log(t.sdp),n.setRemoteDescription(new RTCSessionDescription(t.sdp)).then((function(){}))})),this.mainAppDiv.current.addEventListener("mousemove",(function(){e.controlsContent.current.classList.add("visible"),e.statusBar.current.classList.add("visible"),setTimeout((function(){e.controlsContent.current.classList.remove("visible"),e.statusBar.current.classList.remove("visible")}),5e3)}))}},{key:"render",value:function(){var e=this;if(this.state.disconnected)return this.socket.close(),this.state.localStream.getTracks().forEach((function(e){return e.stop()})),Object(o.jsx)("div",{children:"You have successfully Disconnected"});var t=Object(o.jsx)("div",{style:{color:"red",padding:8},children:this.state.status});return Object(o.jsxs)("div",{className:"app",ref:this.mainAppDiv,children:[Object(o.jsx)(x,{style:{zIndex:101,position:"absolute",right:0,cursor:"move"},children:Object(o.jsx)(g,{videoStyles:{zIndex:2,width:200},frameStyle:{width:200,margin:5,borderRadius:5,backgroundColor:"black"},showMuteControls:!0,videoStream:this.state.localStream,autoPlay:!0,muted:!0})}),Object(o.jsx)(g,{videoStyles:{zIndex:1,position:"fixed",bottom:0,width:"100%",height:"100%",backgroundColor:"rgb(27, 38, 56)"},videoStream:this.state.selectedVideo&&this.state.selectedVideo.stream,autoPlay:!0}),Object(o.jsx)("br",{}),Object(o.jsx)("div",{className:"statusBar",ref:this.statusBar,children:Object(o.jsxs)("div",{style:{margin:5,backgroundColor:"#cdc4ff4f",padding:10,borderRadius:5},children:[" ",t]})}),Object(o.jsx)("div",{children:Object(o.jsx)(O,{switchVideo:this.switchVideo,remoteStreams:this.state.remoteStreams})}),Object(o.jsx)("br",{}),this.state.chatWindow?Object(o.jsx)(y,{user:{uid:this.socket&&this.socket.id||""},messages:this.state.messages,sendMessage:function(t){e.setState((function(e){return{messages:[].concat(Object(m.a)(e.messages),[t])}})),e.state.sendChannels.map((function(e){"open"===e.readyState&&e.send(JSON.stringify(t))})),e.sendToPeer("new-message",JSON.stringify(t),{local:e.socket.id})}}):Object(o.jsx)("div",{}),Object(o.jsx)("div",{className:"controls-content",ref:this.controlsContent,children:Object(o.jsxs)("div",{className:"controls-body",children:[Object(o.jsxs)("div",{className:"button-group-left",children:[Object(o.jsx)("div",{onClick:this.handleChatWindowToggle,children:Object(o.jsx)(D.a,{className:"control-buttons"})}),Object(o.jsx)("div",{onClick:this.shareScreen,children:Object(o.jsx)(R.a,{className:"control-buttons"})})]}),Object(o.jsx)("div",{className:"button-group-center",onClick:function(t){e.setState({disconnected:!0})},children:Object(o.jsx)(w.a,{className:"control-buttons cancel"})}),Object(o.jsx)("div",{className:"button-group-right",children:Object(o.jsx)("div",{className:"fullscreenBtn",onClick:this.handleFullscreen,children:Object(o.jsx)(P.a,{className:"control-buttons",ref:this.fullscreen})})})]})})]})}}]),n}(s.a.Component)),W=n(117),V=n(62),L=n.n(V),E=n.p+"static/media/video-conference.074ca7fc.svg",A=(n(102),function(e){var t=Object(a.useState)([]),n=Object(S.a)(t,2),s=n[0],c=n[1],r=Object(a.useState)(!1),i=Object(S.a)(r,2),l=i[0],d=i[1],u=["YouOnlyLiveOnce","CosmosIsReal","ImpossibleIsForTheUnwilling","NarrativeStormsSettlePersonally","HomeDesktopSacrificeRecklessly","ElementaryMusicianPlantOverall"],m=Object(a.useRef)(),h=Object(a.useRef)(),f=Object(a.useRef)();function j(){Object(W.a)();""===document.querySelector(".roomIdInput").value&&c(h.current),e.history.push("/".concat(s))}Object(a.useEffect)((function(){var e=0,t=0;!function n(o){e===u.length&&(e=0),h.current=u[e],f.current=h.current.slice(0,++t),null!==document.querySelector(".roomIdInput")&&(document.querySelector(".roomIdInput").placeholder=f.current),f.current.length===h.current.length&&(e++,t=0),setTimeout(n,300)}()}),[]);var b=function(e){console.log(e),c(e),document.querySelector(".roomIdInput").defaultValue=s};return Object(o.jsxs)("div",{className:"createRoom",children:[Object(o.jsxs)("div",{className:"heading",children:[Object(o.jsxs)("div",{className:"logo",children:[Object(o.jsx)("img",{src:E,alt:"logo"}),Object(o.jsx)("h1",{className:"logo-name",children:"Rova Meet"})]}),Object(o.jsx)(L.a,{className:"settings"})]}),Object(o.jsxs)("div",{className:"enter-room",children:[Object(o.jsx)("div",{className:"enter-room-container",children:Object(o.jsx)("form",{onSubmit:j,children:Object(o.jsx)("input",{"aria-disabled":"false","aria-label":"Meeting",className:"roomIdInput",type:"text",pattern:"^[^?&:\"'%#]+$",onChange:function(e){return b(e.target.value)},ref:m,title:"Meeting name should not contain any of these characters: ?, &, :, ', \", %, #."})})}),Object(o.jsx)("button",{"aria-disabled":"false","aria-label":"Start meeting",className:"createRoomIdButton",onClick:j,children:"Create Room"})]}),Object(o.jsxs)("div",{className:"roomIdQues-container",children:[Object(o.jsx)("h5",{className:"roomIdQuestion",children:"Already have a Room ID?"}),Object(o.jsx)("button",{className:"joinRoomQuesBtn",onClick:function(){d(!1===l)},children:"Join Room"})]}),l?Object(o.jsxs)("div",{className:"join-room",children:[Object(o.jsx)("div",{className:"join-room-container",children:Object(o.jsx)("form",{onSubmit:j,children:Object(o.jsx)("input",{"aria-disabled":"false","aria-label":"Meeting",className:"roomIdInput",type:"text",pattern:"^[^?&:\"'%#]+$",onChange:function(e){return b(e.target.value)},ref:m,title:"Meeting name should not contain any of these characters: ?, &, :, ', \", %, #."})})}),Object(o.jsx)("button",{"aria-disabled":"false","aria-label":"Join meeting",className:"joinRoomIdButton",onClick:j,children:"Join Room"})]}):Object(o.jsx)("div",{}),"}"]})}),B=n(63),z=n(3),F=function(e){Object(d.a)(n,e);var t=Object(u.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(o.jsx)("div",{className:"app",children:Object(o.jsx)(B.a,{children:Object(o.jsxs)(z.c,{children:[Object(o.jsx)(z.a,{exact:!0,path:"/",component:A}),Object(o.jsx)(z.a,{path:"/:room",component:M})]})})})}}]),n}(a.Component),J=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function U(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}r.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(F,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");J?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var o=n.headers.get("content-type");404===n.status||null!=o&&-1===o.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):U(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):U(t,e)}))}}()},70:function(e,t,n){},93:function(e,t){},96:function(e,t,n){}},[[105,1,2]]]);
//# sourceMappingURL=main.df9e6c5f.chunk.js.map